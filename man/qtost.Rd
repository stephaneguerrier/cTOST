% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/quantile_equivalence.R
\name{qtost}
\alias{qtost}
\title{Quantile equivalence testing procedures}
\usage{
qtost(
  x,
  y,
  pi_x,
  delta,
  alpha = 0.05,
  method = "alpha",
  B = NULL,
  seed = 101010,
  tol = 1e-06,
  max_iter = 10,
  tolpower = 0.001,
  MC_sup = T,
  ...
)
}
\arguments{
\item{x}{A \code{numeric} vector of data for the reference group ($X$), or a  \code{list} containing `mean`, `sd`, and `n`.}

\item{y}{A  \code{numeric} vector of data for the test group ($Y$), or a  \code{list} containing `mean`, `sd`, and `n`.}

\item{pi_x}{A  \code{numeric} scalar or vector specifying the quantile(s) of interest in the reference group $X$ (e.g., 0.9 for the 90th percentile).}

\item{delta}{A \code{numeric} value or vector defining the (bio)equivalence margin(s). The procedure assumes symmetry, i.e., the (bio)equivalence region is \eqn{(\pi_x-\delta, \pi_x+\delta)}. In the multivariate case, it is assumed to be the same across all dimensions.}

\item{alpha}{A \code{numeric} value specifying the significance level, which must be between 0 and 0.5 (default: \code{alpha = 0.05}).}

\item{method}{A \code{character} string specifying the finite sample adjustment method. Available methods are: \code{"unadjusted"} (standard unadjusted qTOST), \code{"alpha"} (alpha-qTOST). Default: \code{method = "alpha"}.}

\item{B}{A \code{numeric} value specifying the number of Monte Carlo replications, required for the `"alpha"` method (default: \code{B = 10^4}).}

\item{seed}{A \code{numeric} value specifying a seed for reproducibility (default: \code{seed = 12345}).}

\item{tol}{A \code{numeric} value specifying a tolerance level (default: \code{tol = .Machine$double.eps}).}

\item{max_iter}{A \code{numeric} value specifying a maximum number of iteration to compute the supremum at which the size is assessed (default: \code{max_iter = 10}).}

\item{tolpower}{A \code{numeric} value specifying the tolerance for power convergence when computing corrected alpha (default: \code{tolpower = 1e-3}).}

\item{MC_sup}{A \code{logical} value indicating whether to use Monte Carlo simulation to find the supremum when computing corrected alpha (default: \code{MC_sup = TRUE}).}

\item{...}{Additional arguments (not currently used).}
}
\value{
An object of class `qtost` (for a single quantile) or `mqtost` (for multiple quantiles) with the following components:
\itemize{
  \item `decision`: The (component-wise) equivalence decision (`TRUE` or `FALSE`).
  \item `method`: The method used (`"qTOST"` or `"alpha-qTOST"`).
  \item `ci`: The $(1 - 2\alpha)$ confidence interval for the estimated quantile $\hat{\pi}_y$.
  \item `pi_y_hat`: The point estimate for the quantile in group Y.
  \item `eq_region`: The defined equivalence region $[\pi_x - \delta, \pi_x + \delta]$.
  \item `alpha`: The nominal significance level.
  \item `corrected_alpha`: The adjusted alpha level used (for `alpha-qTOST` method).
}
}
\description{
Performs a Two One-Sided Test (TOST) to assess the equivalence of a quantile
from a test population ($Y$) with the corresponding quantile from a reference
population ($X$), assuming the data are normally distributed. The test evaluates
if the true quantile $\pi_y$ is within a pre-specified equivalence margin $\delta$
around the reference quantile $\pi_x$.

The null hypotheses for the two one-sided tests are:
$H_{01}: \pi_y \ge \pi_x - \delta$ and $H_{02}: \pi_y \le \pi_x + \delta$.
Equivalence is concluded if both null hypotheses are rejected.
}
\examples{
# https://www.accessdata.fda.gov/drugsatfda_docs/label/2024/021814s030lbl.pdf
# C_trough: table 5
# reference male group
x_bar_orig = 35.6
x_sd_orig = 16.7
n_x = 106
# target female group
y_bar_orig = 41.6
y_sd_orig = 24.3
n_y = 14
# data transformation
x_bar = log(x_bar_orig^2 / sqrt(x_bar_orig^2 + x_sd_orig^2))
x_sd = sqrt(log(1 + (x_sd_orig^2 / x_bar_orig^2)))
y_bar = log(y_bar_orig^2 / sqrt(y_bar_orig^2 + y_sd_orig^2))
y_sd = sqrt(log(1 + (y_sd_orig^2 / y_bar_orig^2)))
x = list(mean=x_bar, sd=x_sd, n=n_x)
y = list(mean=y_bar, sd=y_sd, n=n_y)
# qTOST
sqtost <- qtost(x, y, pi_x = 0.8, delta = 0.15, method = "unadjusted")
print(sqtost)
aqtost <- qtost(x, y, pi_x = 0.8, delta = 0.15, method = "alpha")
print(aqtost)

# Example 2: Using raw data to test a single quantile
set.seed(12345)
x_data <- rnorm(n = 30, mean = 0, sd = 0.1)
y_data <- rnorm(n = 10, mean = 0, sd = 0.1)

# Test the 90th percentile with a margin of delta = 0.05
sqtost <- qtost(x = x_data, y = y_data, pi_x = 0.8, delta = 0.15, method = "unadjusted")
print(sqtost)
aqtost <- qtost(x_data, y_data, pi_x = 0.8, delta = 0.15, method = "alpha")
print(aqtost)

# Example 2: Using summary statistics with the unadjusted method
x_stats <- list(mean = 100, sd = 15, n = 50)
y_stats <- list(mean = 102, sd = 16, n = 50)

result_summary <- qtost(x_stats, y_stats, pi_x = 0.95, delta = 0.03,
                        method = "unadjusted")
print(result_summary)

}
