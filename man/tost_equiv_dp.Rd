% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dp_mean_test.R
\name{tost_equiv_dp}
\alias{tost_equiv_dp}
\title{Differentially Private TOST for Mean Equivalence Testing}
\usage{
tost_equiv_dp(
  mean_private_obs,
  sd_private_obs,
  a,
  b,
  n,
  mean_private_obs2 = NULL,
  sd_private_obs2 = NULL,
  a2 = NULL,
  b2 = NULL,
  n2 = NULL,
  lower,
  upper,
  epsilon,
  alpha = 0.05,
  B = 10^4,
  seed = 1337,
  method = "cpp",
  ...
)
}
\arguments{
\item{mean_private_obs}{Privatized sample mean for the first (or only) group.
This should be the observed mean with differential privacy noise already added.}

\item{sd_private_obs}{Privatized sample standard deviation for the first (or only)
group with differential privacy noise already added.}

\item{a}{Lower bound for data truncation in the first (or only) group.}

\item{b}{Upper bound for data truncation in the first (or only) group.}

\item{n}{Sample size for the first (or only) group.}

\item{mean_private_obs2}{Privatized sample mean for the second group (optional).
If NULL, a one-sample test is performed. Default is NULL.}

\item{sd_private_obs2}{Privatized sample standard deviation for the second group
(optional). Required if mean_private_obs2 is provided. Default is NULL.}

\item{a2}{Lower bound for data truncation in the second group (optional).
If NULL but mean_private_obs2 is provided, defaults to a. Default is NULL.}

\item{b2}{Upper bound for data truncation in the second group (optional).
If NULL but mean_private_obs2 is provided, defaults to b. Default is NULL.}

\item{n2}{Sample size for the second group (optional). Required if mean_private_obs2
is provided. Default is NULL.}

\item{lower}{Lower equivalence bound. For one-sample tests, this is the lower bound
for the mean. For two-sample tests, this is the lower bound for the difference
(μ1 - μ2). Typical value: -delta.}

\item{upper}{Upper equivalence bound. For one-sample tests, this is the upper bound
for the mean. For two-sample tests, this is the upper bound for the difference
(μ1 - μ2). Typical value: delta.}

\item{epsilon}{Privacy budget. Can be a single value (used for all samples) or a
vector of length 2 (epsilon[1] for first group, epsilon[2] for second group).
Larger values provide less privacy but more statistical power.}

\item{alpha}{Significance level for the test. The confidence interval will have
level (1 - 2*alpha). Default is 0.05.}

\item{B}{Number of Monte Carlo replications for reconstructing the sampling
distribution. Larger values provide more accurate results but take longer.
Default is 10000.}

\item{seed}{Random seed for reproducibility. Default is 1337.}

\item{method}{Implementation to use: "cpp" (default, ultra-fast) or "r" (pure R).
The C++ implementation is 15-250x faster depending on problem size.}
}
\value{
A list of class "dp_tost_mean" containing:
  \item{decision}{Logical. TRUE if equivalence is established, FALSE otherwise.}
  \item{conf.int}{Confidence interval for the parameter of interest (mean for
    one-sample, difference for two-sample).}
  \item{lower}{Lower equivalence bound.}
  \item{upper}{Upper equivalence bound.}
  \item{alpha}{Significance level used.}
  \item{epsilon}{Privacy budget(s) used.}
  \item{estimate}{Point estimate(s) of the privatized mean(s).}
  \item{sample_size}{Sample size(s).}
  \item{test_type}{Character string indicating "one-sample" or "two-sample".}
  \item{method}{Method used ("cpp" or "r").}
  \item{seed}{Random seed used.}
  \item{B}{Number of Monte Carlo replications.}
}
\description{
Performs equivalence testing for bounded means under differential privacy using
the DP-TOST procedure. Supports both one-sample and two-sample tests.
}
\details{
This function implements the DP-TOST (Differentially Private Two One-Sided Tests)
procedure for testing equivalence of means while maintaining differential privacy
guarantees. The test uses Monte Carlo simulation with moment-matching optimization
to reconstruct the sampling distribution from privatized statistics.

For the one-sample case, the test evaluates whether a mean is equivalent to a
reference range [lower, upper]. For the two-sample case, it tests whether the
difference between two means (μ1 - μ2) falls within the equivalence bounds
[lower, upper].

The privacy mechanism adds Laplace noise to both the observed mean and standard
deviation. The privacy budget epsilon controls the amount of noise: larger epsilon
values provide less privacy but more accurate inference.
}
\examples{
\dontrun{
# One-sample test: Is mean equivalent to range [1.5, 3.5]?
set.seed(123)
n <- 100
a <- 0
b <- 5
mu_true <- 2.5
sigma_true <- 1.0
epsilon <- 1

# Generate truncated normal data
z <- rnorm(n)
x <- pmin(pmax(mu_true + sigma_true * z, a), b)
mean_obs <- mean(x)
sd_obs <- sd(x)

# Add Laplace noise
delta_f_mean <- (b - a) / n
delta_f_sd <- (b - a) / sqrt(n - 1)
scale_mean <- delta_f_mean / (epsilon / 2)
scale_sd <- delta_f_sd / (epsilon / 2)

u <- runif(2)
mean_private <- mean_obs - scale_mean * sign(u[1] - 0.5) * log(1 - 2 * abs(u[1] - 0.5))
sd_private <- sd_obs - scale_sd * sign(u[2] - 0.5) * log(1 - 2 * abs(u[2] - 0.5))

result <- tost_equiv_dp(
  mean_private_obs = mean_private,
  sd_private_obs = sd_private,
  a = a, b = b, n = n,
  lower = 1.5,
  upper = 3.5,
  epsilon = 1,
  B = 1000
)
result

# Two-sample test: Is difference (μ1 - μ2) equivalent to [-1, 1]?
set.seed(456)
n1 <- 100
n2 <- 100
a1 <- 0; b1 <- 5
a2 <- 0; b2 <- 5
mu1_true <- 2.5
mu2_true <- 2.3
sigma1_true <- 1.0
sigma2_true <- 1.2
epsilon <- 1

# Generate data for both groups
z1 <- rnorm(n1)
z2 <- rnorm(n2)
x1 <- pmin(pmax(mu1_true + sigma1_true * z1, a1), b1)
x2 <- pmin(pmax(mu2_true + sigma2_true * z2, a2), b2)

# Add Laplace noise to both groups
scale_mean1 <- ((b1 - a1) / n1) / (epsilon / 2)
scale_sd1 <- ((b1 - a1) / sqrt(n1 - 1)) / (epsilon / 2)
scale_mean2 <- ((b2 - a2) / n2) / (epsilon / 2)
scale_sd2 <- ((b2 - a2) / sqrt(n2 - 1)) / (epsilon / 2)

u1 <- runif(2)
u2 <- runif(2)
mean_private1 <- mean(x1) - scale_mean1 * sign(u1[1] - 0.5) * log(1 - 2 * abs(u1[1] - 0.5))
sd_private1 <- sd(x1) - scale_sd1 * sign(u1[2] - 0.5) * log(1 - 2 * abs(u1[2] - 0.5))
mean_private2 <- mean(x2) - scale_mean2 * sign(u2[1] - 0.5) * log(1 - 2 * abs(u2[1] - 0.5))
sd_private2 <- sd(x2) - scale_sd2 * sign(u2[2] - 0.5) * log(1 - 2 * abs(u2[2] - 0.5))

result <- tost_equiv_dp(
  mean_private_obs = mean_private1,
  sd_private_obs = sd_private1,
  a = a1, b = b1, n = n1,
  mean_private_obs2 = mean_private2,
  sd_private_obs2 = sd_private2,
  a2 = a2, b2 = b2, n2 = n2,
  lower = -1,
  upper = 1,
  epsilon = 1,
  B = 1000
)
result
}


}
